<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÂßøÂ∑ù„Éì„É≥„Ç¥</title>
  <style>
    body {
      font-family: 'Hiragino Sans', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 20px;
      background: #f9f9f9;
      margin: 0;
      height: 100vh;
    }

    h1 {
      margin-bottom: 15px;
      font-size: 22px;
      font-weight: bold;
      color: #333;
    }

    .bingo {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      grid-gap: 8px;
      margin-bottom: 20px;
    }

    .cell {
      width: 60px;
      height: 60px;
      background: white;
      border: 2px solid #ccc;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: default;
      transition: all 0.4s ease;
    }

    .cell.active {
      background: #ffc400;
      color: #fff;
      border-color: gold;
      box-shadow: 0 0 12px rgba(255,190,0,0.9);
      animation: glow 0.6s;
    }

    @keyframes glow {
      0% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    #scanBtn {
      width: 90%;
      max-width: 300px;
      padding: 13px;
      font-size: 18px;
      border: none;
      background: #007aff;
      color: white;
      border-radius: 10px;
      cursor: pointer;
    }

    #scanner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    #message {
      margin-top: 15px;
      font-size: 22px;
      font-weight: bold;
      color: #e91e63;
      display: none;
    }
  </style>
</head>
<body>

  <h1>ÂßøÂ∑ù„Éì„É≥„Ç¥</h1>
  <div class="bingo" id="bingo"></div>

  <button id="scanBtn">üì∑ QR„Ç≥„Éº„Éâ„ÇíË™≠„ÅøÂèñ„Çã</button>
  <div id="scanner"></div>

  <div class="message" id="message"></div>

  <script src="https://unpkg.com/html5-qrcode"></script>

  <script>
    const bingo = document.getElementById('bingo');
    const scanner = document.getElementById('scanner');
    const message = document.getElementById('message');
    const size = 5;
    const cells = [];
    let usedLines = new Set();

    // „Éì„É≥„Ç¥„É©„Ç§„É≥ÂÆöÁæ©ÔºàFREEÂê´„ÇÄÔºâ
    const lines = [
      [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],
      [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],
      [0,6,12,18,24],[4,8,12,16,20]
    ];

    // Áõ§Èù¢ÁîüÊàêÔºàB1-B25Ôºâ
    for (let i = 0; i < 25; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.textContent = "B" + (i + 1);
      bingo.appendChild(cell);
      cells.push(cell);
    }

    // FREE‰∏≠Â§Æ(B13)„ÅØÊúÄÂàù„Åã„ÇâÂÖâ„Çã
    cells[12].classList.add("active");

    // QR‚Üí„Éû„ÇπÁÇπÁÅØ
    function activateCellByCode(text) {
      if (!text.startsWith("B")) return;

      const num = parseInt(text.substring(1));
      if (num >= 1 && num <= 25) {
        const index = num - 1;
        if (!cells[index].classList.contains("active")) {
          cells[index].classList.add("active");
        }
        checkBingo();
      }
    }

    function checkBingo() {
      const grid = cells.map(c => c.classList.contains("active"));
      let newlyCompleted = 0;

      lines.forEach((line, idx) => {
        if (!usedLines.has(idx) && line.every(i => grid[i])) {
          usedLines.add(idx);
          newlyCompleted++;
        }
      });

      if (usedLines.size === lines.length) {
        showMessage("üéä COMPLETE! üéä", true);
        return;
      }

      if (newlyCompleted > 0) {
        const msg = newlyCompleted === 1 ?
          "üéâ BINGO! üéâ" :
          `‚ú® ${newlyCompleted}„É©„Ç§„É≥ BINGO!! ‚ú®`;
        showMessage(msg, false);
      }
    }

    function showMessage(text, permanent) {
      message.textContent = text;
      message.style.display = "block";
      if (!permanent) {
        setTimeout(() => {
          message.style.display = "none";
        }, 2000);
      }
    }

    // „Çπ„Ç≠„É£„É≥
    const scanBtn = document.getElementById("scanBtn");
    let html5QrcodeScanner;

    scanBtn.addEventListener("click", () => {
      scanner.style.display = "flex";
      html5QrcodeScanner = new Html5Qrcode("scanner");
      html5QrcodeScanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        (decodedText) => {
          html5QrcodeScanner.stop();
          scanner.style.display = "none";
          activateCellByCode(decodedText);
        }
      ).catch(err => {
        console.error(err);
        scanner.style.display = "none";
      });
    });
  </script>

</body>
</html>


